<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ace="http://www.icefaces.org/icefaces/components"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
>


<h:head>
    <title>Main page</title>
    <link rel="stylesheet" href="styles/main.css" />
</h:head>

<h:body>
    <div class="container">
        <header class="header">
            <h1>Проверка попадания точки в область</h1>
            <h:link outcome="start" value="На стартовую страницу" styleClass="nav-link"/>
        </header>

        <div class="main-content">
            <div class="left-panel">
                <h:form id="check-form">
                    <p:messages id="messages" showDetail="true" closable="true">
                        <p:autoUpdate/>
                    </p:messages>

                    <div class="form-group">
                        <h:outputLabel value="Изменение X (-5 ... 5):"/>
                        <ace:sliderEntry min="-5" max="5" value="#{pointBean.x}" />
                    </div>

                    <div class="form-group">
                        <h:outputLabel for="y-text" value="Введите Y (-5 ... 5):"/>
                        <p:inputText id="y-text" value="#{pointBean.y}" required="true" requiredMessage="Поле Y не может быть пустым." validatorMessage="Y должен быть в диапазоне от -5 до 5.">
                            <f:validateDoubleRange minimum="-5" maximum="5"/>
                        </p:inputText>
                        <p:message for="y-text"/>
                    </div>

                    <div class="form-group">
                        <h:outputLabel for="r-slider-component" value="Выберите R (2 ... 5):"/>
                        <p:slider id="r-slider-component" for="r-text" minValue="2" maxValue="5" step="0.1"/>
                        <h:inputHidden id="r-text" value="#{pointBean.r}" />
                        <h:outputText value="#{pointBean.r}" styleClass="slider-value"/>
                        <p:ajax event="slideEnd" process="@this, r-text" update="graphik-group"/>
                    </div>

                    <div class="form-buttons">
                        <p:commandButton value="Проверить" action="#{pointBean.checkHit}"
                                         update="results-table graphik-group messages" process="check-form @this"/>
                    </div>

                    <h:inputHidden id="graph-x" value="#{pointBean.x}" />
                    <h:inputHidden id="graph-y" value="#{pointBean.y}" />

                    <p:remoteCommand name="sendPointFromGraph" actionListener="#{pointBean.checkHit}" update="results-table graphik-group messages" process="@this graph-x graph-y r-text"/>
                </h:form>
            </div>

            <div class="right-panel">
                <h:panelGroup id="graphik-group" layout="block">
                    <svg id="graphik" width="300" height="300" xmlns="http://www.w3.org/2000/svg" onclick="handleGraphClick(event, #{pointBean.r})">
                        <rect width="300" height="300" fill="white" stroke="black" />
                        <line x1="0" y1="150" x2="300" y2="150" stroke="black" />
                        <line x1="150" y1="0" x2="150" y2="300" stroke="black" />
                        <polygon points="300,150 290,145 290,155" fill="black"/>
                        <polygon points="150,0 145,10 155,10" fill="black"/>
                        <text x="285" y="140">X</text>
                        <text x="160" y="15">Y</text>

                        <polygon points="150,150 #{150 - pointBean.r * 30},150 150,#{150 - pointBean.r*15}" fill="#3399ff" fill-opacity="0.7"/>
                        <rect x="#{150 - pointBean.r * 30}" y="150" width="#{pointBean.r * 30}" height="#{pointBean.r * 30}" fill="#3399ff" fill-opacity="0.7"/>
                        <path d="M 150,150 L #{150 + pointBean.r * 15},150 A #{pointBean.r * 15},#{pointBean.r * 15} 0 0 0 150,#{150 + pointBean.r * 15} Z" fill="#3399ff" fill-opacity="0.7"/>

                        <ui:decorate>
                            <ui:repeat value="#{resultsManagerBean.results}" var="point">
                                <circle cx="#{150 + (point.x / point.r) * (point.r * 30)}"
                                        cy="#{150 - (point.y / point.r) * (point.r * 30)}"
                                        r="3"
                                        fill="#{point.hitResult ? 'green' : 'red'}" />
                            </ui:repeat>
                        </ui:decorate>

                    </svg>
                </h:panelGroup>
            </div>
        </div>

        <div class="table-container">
            <p:dataTable id="results-table" var="res" value="#{resultsManagerBean.results}" rows="10" paginator="true"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowsPerPageTemplate="5,10,15">
                <p:column headerText="X"><h:outputText value="#{res.x}"/></p:column>
                <p:column headerText="Y"><h:outputText value="#{res.y}"/></p:column>
                <p:column headerText="R"><h:outputText value="#{res.r}"/></p:column>
                <p:column headerText="Попадание"><h:outputText value="#{res.hitResult ? 'Да' : 'Нет'}" styleClass="#{res.hitResult ? 'hit-yes' : 'hit-no'}"/></p:column>
                <p:column headerText="Время"><h:outputText value="#{res.checkTimestamp}"><f:convertDateTime pattern="HH:mm:ss"/></h:outputText></p:column>
                <p:column headerText="Выполнение (нс)"><h:outputText value="#{res.executionTime}"/></p:column>
            </p:dataTable>
        </div>
    </div>

    <script src="js/graph.js"></script>
</h:body>
</html>